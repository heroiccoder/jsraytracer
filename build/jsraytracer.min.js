//! jsraytracer 0.0.1

"use strict";!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports&&module.exports?module.exports=b():a.jsraytracer=b()}(this,function(){var a={},b=a.Vec4=function(a,b,c){this.x=+a||0,this.y=+b||0,this.z=+c||0,this.w=0};b.prototype.copy=function(){var a=new b(this.x,this.y,this.z);return a.w=this.w,a},b.prototype.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},b.prototype.cross=function(a,c){var d=new b;return d.x=a.y*c.z-a.z*c.y,d.y=-(a.x*c.z-a.z*c.x),d.z=a.x*c.y-a.y*c.x,d},b.prototype.cross_s=function(a,b,c){c.x=a.y*b.z-a.z*b.y,c.y=-(a.x*b.z-a.z*b.x),c.z=a.x*b.y-a.y*b.x},b.prototype.norm=function(){return Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z)},b.prototype.mult=function(a){vec_result=new b,vec_result.x=this.x*a,vec_result.y=this.y*a,vec_result.z=this.z*a,vec_result.w=0},b.prototype.resta=function(a){return vec_result=new b,v=this,vec_result.x=v.x-a.x,vec_result.y=v.y-a.y,vec_result.z=v.z-a.z,vec_result.w=v.w-a.w,vec_result},b.prototype.suma=function(a){return vec_result=new b,v=this,vec_result.x=v.x+a.x,vec_result.y=v.y+a.y,vec_result.z=v.z+a.z,vec_result.w=v.w+a.w,vec_result};var c=(a.Sphere=function(a,b,c,d,e,f,g,h){return this.center=a,this.radius=b,this.color_dif=c,this.color_spec=d,this.coef_spec=e,this.coef_ref=f,this.coef_refr=g,this.coef_tr=h,this},a.Material=function(a,b,c,d,e,f){this.color_dif=a||null,this.color_spec=b||null,this.coef_ref=d||null,this.coef_tr=e||null,this.coef_refr=f||null}),d=a.Interseccion=function(a,b,c,d,e,f){this.exists=a||0,this.sphere=b||null,this.t=c||null,this.P=d||null,this.N=e||null,this.M=f||null},e=a.Color=function(a,b,c){this.r=0|a,this.g=0|b,this.b=0|c};e.prototype.mult=function(a){var b=new e(this.r,this.g,this.b);return b.r=b.r*a>255?255:int(a*b.r),b.g=b.g*a>255?255:int(a*b.g),b.b=b.b*a>255?255:int(a*b.b),b},e.prototype.suma=function(a){var b,c,d,f,g,h=new e(this.r,this.g,this.b),i=0;return b=Math.floor(h.r),d=Math.floor(h.g),g=Math.floor(h.b),c=Math.floor(a.r),f=Math.floor(a.g),i=Math.floor(a.b),h.r=255>b+c?h.r+a.r:255,h.g=255>d+f?h.g+a.g:255,h.b=255>g+i?h.b+a.b:255,h};var f=a.Canvas=function(a,b){this.width=a,this.height=b,this.pixels=this.create_matrix(a,b)};f.prototype.create_matrix=function(a,b){var c=new Array(a),d=0,f=0;for(d=0;a>d;d++)for(c[d]=new Array(b),f=0;b>f;f++)c[d][f]=new e(0,0,0);return c},f.prototype.putpixel=function(a,b,c){this.pixels[a][b]=c};var g=(a.PointLight=function(a,b,c){this.vec=a,this.intensity=b,this.color=c},a.DirectionalLight=function(a,b,c){this.vec=a,this.intensity=b,this.color=c},a.SpotLight=function(a,b,c,d,e){this.vec=a,this.direction=b,this.angle=c,this.intensity=d,this.color=e},a.Raytracer=function(){});g.prototype.lambert=function(a,c,d,e,f,g){var h=new b;h.x=-d.x,h.y=-d.y,h.z=-d.z,h.w=0;var i=c.norm();c=c.mult(1/i),c.w=0,i=a.P.norm(),a.P=a.P.mult(1/i),a.P.w=0;var j=0;j=a.N.dot(c)/(a.N.norm()*c.norm()),0>j&&(j=0),e+=j*g;var k=0;k=a.N.dot(c);var l=a.N.mult(2);R=l.rest(l.mult(k),c),R.w=0;var m=R.dot(h)/(R.norm()*h.norm());m>1&&(m=1),0>m&&(m=0),-1!=a.M.coef_spec&&(m=Math.pow(m,a.M.coef_spec),f+=m*g),f>1&&(f=1)},g.prototype.get_distance=function(a,b){var c=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z);return Math.sqrt(c)},g.intersectar=function(a,f,g,h,i){for(var j=f.dot(f),k=0,l=0,m=h,n=new d(0,null,null,new b,new b,new c(new e,new e,0,0,0,0)),o=0;o<i.length;o++){sp=i[o];var p=sp.center,q=sp.radius,r=a.resta(p);k=2*f.dot(r),l=r.dot(r)-q*q;var s=k*k-4*j*l;if(s>=0){var t=(-k-Math.sqrt(k*k-4*j*l))/(2*j),u=(-k+Math.sqrt(k*k+4*j*l))/(2*j);if(t>u?t=u:0===s&&(t=-k/(2*j)),t>=g&&h>t&&m>t){m=t;var v=f.mult(m),w=v.sum(a),x=w.resta(p),y=x.norm();x=x.mult(1/y),n.exists=1,n.P=w,n.N=x,n.t=m,n.sp=sp;var z=sp.color_dif,A=sp.color_spec,B=sp.coef_spec,C=sp.coef_ref,D=new c;D.color_dif=z,D.color_spec=A,D.coef_spec=B,D.coef_ref=C,D.coef_refr=sp.coef_refr,n.M=D}}}return n},g.prototype.execute(x_p,y_p);var h,i,j=0,k=this.cam,l=this.view,m=this.up,n=this.d,o=this.vw,p=this.vh,q=this.cw,r=this.ch,s=this.ambient,t=this.pointLights,u=this.directionalLights,w=this.spheres,x=this.antialiasing,y=(new Matrix4).makeIdentity();if(0==m.dot(m,l)){var z=m.norm();m.x=m.x/z,m.y=m.y/z,m.z=m.z/z,z=l.norm(),l.x=l.x/z,l.y=l.y/z,l.z=l.z/z;var A=m.cross(m,l);z=A.norm(),A.x=A.x/z,A.y=A.y/z,A.z=A.z/z,A.w=0,y.matrix[0][2]=l.x,y.matrix[1][2]=l.y,y.matrix[2][2]=l.z,y.matrix[3][2]=l.w,y.matrix[0][1]=m.x,y.matrix[1][1]=m.y,y.matrix[2][1]=m.z,y.matrix[3][1]=m.w,y.matrix[0][0]=A.x,y.matrix[1][0]=A.y,y.matrix[2][0]=A.z,y.matrix[3][0]=A.w}var x=this.antialiasing;h=x_p*o/q,i=y_p*p/r,j=n;var B=k.copy();if(x){var C=(x_p+.5)*o/q,D=(y_p+.5)*o/q,E=new b(h,i,j),F=y.multVec(E),G=new b(C,i,j),H=y.multVec(G),I=new b(h,D,j),J=y.multVec(I),K=new b(C,D,j),L=y.multVec(K),M=raytracer.trazar_rayo(0,F,1,Number.MAX_SAFE_INTEGER,3,s,t,u,w,1,null),N=raytracer.trazar_rayo(0,H,1,Number.MAX_SAFE_INTEGER,3,s,t,u,w,1,null),O=raytracer.trazar_rayo(0,J,1,Number.MAX_SAFE_INTEGER,3,s,t,u,w,1,null),P=raytracer.trazar_rayo(0,L,1,Number.MAX_SAFE_INTEGER,3,s,t,u,w,1,null);M=M.mult(.25),N=N.mult(.25),O=O.mult(.25),P=P.mult(.25);var Q=M.suma(N).suma(O).suma(P);return Q}var S=new b(h,i,j),T=y.multVec(S),Q=raytracer.trazar_rayo(B,T,1,Number.MAX_SAFE_INTEGER,3,s,t,u,w,1,null);return g.prototype.trazar_rayo=function(a,c,d,f,g,h,i,j,k){var l=intersectar(a,c,d,f,k),m=new e,n=1;if(l.exists){m=l.M.color_dif.mult(h);var o,p,q=0,r=0,s=0;for(p=0;p<i.length;p++){var t=i[p];o=new b(t.vec.x-l.P.x,t.vec.y-l.P.y,t.vec.z-l.P.z),s=intersectar(l.P,o,1e-4,1,sphere),s.exists||Lambert(l,o,c,q,r,t.intensity)}for(p=0;p<j.length;p++){var u=j[p];o=new b(-u.vec.x,-u.vec.y,-u.vec.z),s=intersectar(l.P,o,1e-4,1/0,k),s.exists||Lambert(l,o,c,q,r,u.intensity)}if(n&&g>0&&l.M.coef_ref>0){m=l.M.color_dif.mult(q).sum(l.M.color_spec.mult(r),m);{var v=new b,w=v.resta(c);l.N.mult(2*l.N.dot(w)).sum(c)}}}return m},a});
//# sourceMappingURL=jsraytracer.min.js.map