//! jsraytracer 0.0.1

function Vec4(a,b,c){this.x=+a||0,this.y=+b||0,this.z=+c||0,this.w=0}function Sphere(a,b,c,d,e,f,g,h){return this.center=a,this.radius=b,this.c_dif=c,this.c_spec=d,this.coef_spec=e,this.coef_ref=f,this.coef_refr=g,this.coef_tr=h,this}function Material(a,b,c,d,e,f){this.color_dif=a||null,this.color_spec=b||null,this.coef_ref=d||null,this.coef_tr=e||null,this.coef_refr=f||null}function Interseccion(a,b,c,d,e,f){this.exists=a||0,this.sphere=b||null,this.t=c||null,this.P=d||null,this.N=e||null,this.M=f||null}function Color(a,b,c){this.r=0|a,this.g=0|b,this.b=0|c}function Canvas(a,b){this.width=a,this.height=b,this.pixels=this.create_matrix(a,b)}function Raytracer(){}Vec4.prototype.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},Vec4.prototype.cross=function(a,b){var c=new Vec4;return c.x=a.y*b.z-a.z*b.y,c.y=-(a.x*b.z-a.z*b.x),c.z=a.x*b.y-a.y*b.x,c},Vec4.prototype.cross_s=function(a,b,c){c.x=a.y*b.z-a.z*b.y,c.y=-(a.x*b.z-a.z*b.x),c.z=a.x*b.y-a.y*b.x},Vec4.prototype.norm=function(){return Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z)},Vec4.prototype.mult=function(a){vec_result=new Vec4,vec_result.x=this.x*a,vec_result.y=this.y*a,vec_result.z=this.z*a,vec_result.w=0},Vec4.prototype.resta=function(a){return vec_result=new Vec4,v=this,vec_result.x=v.x-a.x,vec_result.y=v.y-a.y,vec_result.z=v.z-a.z,vec_result.w=v.w-a.w,vec_result},Vec4.prototype.suma=function(a){return vec_result=new Vec4,v=this,vec_result.x=v.x+a.x,vec_result.y=v.y+a.y,vec_result.z=v.z+a.z,vec_result.w=v.w+a.w,vec_result},Color.prototype.mult=function(a){var b=new Color(this.r,this.g,this.b);return b.r=b.r*a>255?255:int(a*b.r),b.g=b.g*a>255?255:int(a*b.g),b.b=b.b*a>255?255:int(a*b.b),b},Color.prototype.suma=function(a){var b,c,d,e,f,g=new Color(this.r,this.g,this.b),h=0;return b=Math.floor(g.r),d=Math.floor(g.g),f=Math.floor(g.b),c=Math.floor(a.r),e=Math.floor(a.g),h=Math.floor(a.b),g.r=255>b+c?g.r+a.r:255,g.g=255>d+e?g.g+a.g:255,g.b=255>f+h?g.b+a.b:255,g},Canvas.prototype.create_matrix=function(a,b){var c=new Array(a),d=0,e=0;for(d=0;a>d;d++)for(c[d]=new Array(b),e=0;b>e;e++)c[d][e]=new Color(0,0,0);return c},Canvas.prototype.putpixel=function(a,b,c){this.pixels[Math.floor(a+this.width/2)][Math.floor(-b+this.height/2)]=c},Raytracer.prototype.lambert=function(a,b,c,d,e,f){var g=new Vec4;g.x=-c.x,g.y=-c.y,g.z=-c.z,g.w=0;var h=b.norm();b=b.mult(1/h),b.w=0,h=a.P.norm(),a.P=a.P.mult(1/h),a.P.w=0;var i=0;i=a.N.dot(b)/(a.N.norm()*b.norm()),0>i&&(i=0),d+=i*f;var j=0;j=a.N.dot(b);var k=a.N.mult(2);R=k.rest(k.mult(j),b),R.w=0;var l=R.dot(g)/(R.norm()*g.norm());l>1&&(l=1),0>l&&(l=0),-1!=a.M.coef_spec&&(l=Math.pow(l,a.M.coef_spec),e+=l*f),e>1&&(e=1)},Raytracer.prototype.get_distance=function(a,b){var c=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z);return Math.sqrt(c)},Raytracer.intersectar=function(a,b,c,d,e){for(var f=b.dot(b),g=0,h=0,i=d,j=new Interseccion(0,null,null,new Vec4,new Vec4,new Material(new Color,new Color,0,0,0,0)),k=0;k<e.length;k++){sp=e[k];var l=sp.center,m=sp.radius,n=a.resta(l);g=2*b.dot(n),h=n.dot(n)-m*m;var o=g*g-4*f*h;if(o>=0){var p=(-g-Math.sqrt(g*g-4*f*h))/(2*f),q=(-g+Math.sqrt(g*g+4*f*h))/(2*f);if(p>q?p=q:0===o&&(p=-g/(2*f)),p>=c&&d>p&&i>p){i=p;var r=b.mult(i),s=r.sum(a),t=s.resta(l),u=t.norm();t=t.mult(1/u),j.exists=1,j.P=s,j.N=t,j.t=i,j.sp=sp;var v=sp.color_dif,w=sp.color_spec,x=sp.coef_spec,y=sp.coef_ref,z=new Material;z.color_dif=v,z.color_spec=w,z.coef_spec=x,z.coef_ref=y,z.coef_refr=sp.coef_refr,j.M=z}}}return j},Raytracer.prototype.trazar_rayo=function(a,b,c,d,e,f,g,h,i){var j=intersectar(a,b,c,d,i),k=new Color,l=1;if(j.exists){k=j.M.color_dif.mult(f);var m,n,o=0,p=0,q=0;for(n=0;n<g.length;n++)pl=g[n],m=new Vec4(pl.vec.x-j.P.x,pl.vec.y-j.P.y,pl.vec.z-j.P.z),q=intersectar(j.P,m,1e-4,1,sphere),q.exists||Lambert(j,m,b,o,p,pl.intensity);for(n=0;n<h.length;n++)dl=h[n],m=new Vec4(-dl.vec.x,-dl.vec.y,-dl.vec.z),q=intersectar(j.P,m,1e-4,1/0,i),q.exists||Lambert(j,m,b,o,p,dl.intensity);if(l&&e>0&&j.M.coef_ref>0){k=j.M.color_dif.mult(o).sum(j.M.color_spec.mult(p),k);{var r=new Vec4,s=r.resta(b);j.N.mult(2*j.N.dot(s)).sum(b)}}}};
//# sourceMappingURL=jsraytracer.min.js.map