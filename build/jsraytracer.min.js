//! jsraytracer 0.0.1

!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof exports&&module.exports?module.exports=b():a.jsraytracer=b()}(this,function(){"use strict";var a={},b=a.Vec4=function(a,b,c){this.x=+a||0,this.y=+b||0,this.z=+c||0,this.w=0};b.prototype.copy=function(){var a=new b(this.x,this.y,this.z);return a.w=this.w,a},b.prototype.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},b.prototype.cross=function(a,c){var d=new b;return d.x=a.y*c.z-a.z*c.y,d.y=-(a.x*c.z-a.z*c.x),d.z=a.x*c.y-a.y*c.x,d},b.prototype.cross_s=function(a,b,c){c.x=a.y*b.z-a.z*b.y,c.y=-(a.x*b.z-a.z*b.x),c.z=a.x*b.y-a.y*b.x},b.prototype.norm=function(){var a=this;return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)},b.prototype.mult=function(a){var c=new b;c.x=this.x*a,c.y=this.y*a,c.z=this.z*a,c.w=0},b.prototype.resta=function(a){var c=new b,d=this;return c.x=d.x-a.x,c.y=d.y-a.y,c.z=d.z-a.z,c.w=d.w-a.w,c},b.prototype.suma=function(a){var c=new b,d=this;return c.x=d.x+a.x,c.y=d.y+a.y,c.z=d.z+a.z,c.w=d.w+a.w,c};var c=(a.Sphere=function(a,b,c,d,e,f,g,h){return this.center=a,this.radius=b,this.color_dif=c,this.color_spec=d,this.coef_spec=e,this.coef_ref=f,this.coef_refr=g,this.coef_tr=h,this},a.Material=function(a,b,c,d,e,f){this.color_dif=a||null,this.color_spec=b||null,this.coef_ref=d||null,this.coef_tr=e||null,this.coef_refr=f||null}),d=a.Interseccion=function(a,b,c,d,e,f){this.exists=a||0,this.sphere=b||null,this.t=c||null,this.P=d||null,this.N=e||null,this.M=f||null},e=a.Color=function(a,b,c){this.r=0|a,this.g=0|b,this.b=0|c};e.prototype.mult=function(a){var b=new e(this.r,this.g,this.b);return b.r=b.r*a>255?255:Math.floor(a*b.r),b.g=b.g*a>255?255:Math.floor(a*b.g),b.b=b.b*a>255?255:Math.floor(a*b.b),b},e.prototype.suma=function(a){var b,c,d,f,g,h=new e(this.r,this.g,this.b),i=0;return b=Math.floor(h.r),d=Math.floor(h.g),g=Math.floor(h.b),c=Math.floor(a.r),f=Math.floor(a.g),i=Math.floor(a.b),h.r=255>b+c?h.r+a.r:255,h.g=255>d+f?h.g+a.g:255,h.b=255>g+i?h.b+a.b:255,h},e.prototype.toRGB=function(){return(255&this.r)<<16|(255&this.g)<<8|255&this.b};var f=a.Canvas=function(a,b){this.width=a,this.height=b,this.pixels=this.create_matrix(a,b)};f.prototype.create_matrix=function(a,b){var c=new Array(a),d=0,f=0;for(d=0;a>d;d++)for(c[d]=new Array(b),f=0;b>f;f++)c[d][f]=new e(0,0,0);return c},f.prototype.putpixel=function(a,b,c){this.pixels[a][b]=c};var g=a.Matrix4=function(){this.matrix=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]};g.prototype.makeIdentity=function(){var a=new g;return a.matrix[0][0]=1,a.matrix[1][1]=1,a.matrix[2][2]=1,a.matrix[3][3]=1,a},g.prototype.makeXRot=function(a){a=a/180*Math.PI;var b=new g;return b.matrix[0][0]=1,b.matrix[3][3]=1,b.matrix[1][1]=Math.cos(a),b.matrix[1][2]=-Math.sin(a),b.matrix[2][1]=Math.sin(a),b.matrix[2][2]=Math.cos(a),b},g.prototype.makeYRot=function(a){a=a/180*Math.PI;var b=new g;return b.matrix[1][1]=1,b.matrix[3][3]=1,b.matrix[0][0]=Math.cos(a),b.matrix[2][0]=-Math.sin(a),b.matrix[0][2]=Math.sin(a),b.matrix[2][2]=Math.cos(a),b},g.prototype.makeZRot=function(a){a=a/180*Math.PI;var b=new g;return b.matrix[2][2]=1,b.matrix[3][3]=1,b.matrix[0][0]=Math.cos(a),b.matrix[0][1]=-Math.sin(a),b.matrix[1][0]=Math.sin(a),b.matrix[1][1]=Math.cos(a),b},g.prototype.makeScale=function(a,b,c){var d=this.makeIdentity();return d.matrix[0][0]=a,d.matrix[1][1]=b,d.matrix[2][2]=c,d},g.prototype.makeTranslation=function(a,b,c){var d=this.makeIdentity();return d.matrix[0][3]=a,d.matrix[1][3]=b,d.matrix[2][3]=c,d},g.prototype.makeModel=function(a,b){var c=0,d=this.makeIdentity(),e=this.makeIdentity(),f=this.makeIdentity();if(0===b)return null;if(1==b)return a[0].multMatrix(d,e),e;for(a[0].multMatrix(d,f),c=1;b>c;c++)a[c].multMatrix(f,e),e.multMatrix(e,d,f);return e},g.prototype.makeProjection=function(a){var b=this.makeIdentity();return b.matrix.matrix[0][0]=a,b.matrix.matrix[1][1]=a,b.matrix.matrix[2][2]=a,b.matrix.matrix[3][2]=1,b.matrix.matrix[3][3]=0,b},g.prototype.makeView=function(a,b){return this.makeModel(a,b)},g.prototype.copy3d=function(a){for(var b=0;b<this.matrix.length;b++)for(var c=0;c<this.matrix[0].length;c++)a.matrix[b][c]=this.matrix[b][c]},g.prototype.multMatrix=function(a,b){if(this.matrix[0].length==a.matrix.length&&b.matrix[0].length==a.matrix[0].length&&b.matrix.length==this.matrix.length)for(var c=0;c<b.matrix[0].length;c++)for(var d=0;d<b.matrix.length;d++){for(var e=0,f=0;f<this.matrix[0].length;f++)e+=this.matrix[d][f]*a.matrix[f][c];b.matrix[d][c]=e}},g.prototype.multVec=function(a){var c=this.matrix,d=new b;return d.x=c[0][0]*a.x+c[0][1]*a.y+c[0][2]*a.z+c[0][3]*a.w,d.y=c[1][0]*a.x+c[1][1]*a.y+c[1][2]*a.z+c[1][3]*a.w,d.y=c[2][0]*a.x+c[2][1]*a.y+c[2][2]*a.z+c[2][3]*a.w,d.y=c[3][0]*a.x+c[3][1]*a.y+c[3][2]*a.z+c[3][3]*a.w,d};var h=(a.PointLight=function(a,b,c){this.vec=a,this.intensity=b,this.color=c},a.DirectionalLight=function(a,b,c){this.vec=a,this.intensity=b,this.color=c},a.SpotLight=function(a,b,c,d,e){this.vec=a,this.direction=b,this.angle=c,this.intensity=d,this.color=e},a.Raytracer=function(){});return h.prototype.lambert=function(a,c,d,e,f,g){var h=new b;h.x=-d.x,h.y=-d.y,h.z=-d.z,h.w=0;var i=c.norm();c=c.mult(1/i),c.w=0,i=a.P.norm(),a.P=a.P.mult(1/i),a.P.w=0;var j=0;j=a.N.dot(c)/(a.N.norm()*c.norm()),0>j&&(j=0),e+=j*g;var k=0;k=a.N.dot(c);var l=a.N.mult(2),m=l.rest(l.mult(k),c);m.w=0;var n=m.dot(h)/(m.norm()*h.norm());n>1&&(n=1),0>n&&(n=0),-1!=a.M.coef_spec&&(n=Math.pow(n,a.M.coef_spec),f+=n*g),f>1&&(f=1)},h.prototype.get_distance=function(a,b){var c=(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y)+(b.z-a.z)*(b.z-a.z);return Math.sqrt(c)},h.intersectar=function(a,f,g,h,i){for(var j=f.dot(f),k=0,l=0,m=h,n=new d(0,null,null,new b,new b,new c(new e,new e,0,0,0,0)),o=0;o<i.length;o++){var p=i[o],q=p.center,r=p.radius,s=a.resta(q);k=2*f.dot(s),l=s.dot(s)-r*r;var t=k*k-4*j*l;if(t>=0){var u=(-k-Math.sqrt(k*k-4*j*l))/(2*j),v=(-k+Math.sqrt(k*k+4*j*l))/(2*j);if(u>v?u=v:0===t&&(u=-k/(2*j)),u>=g&&h>u&&m>u){m=u;var w=f.mult(m),x=w.sum(a),y=x.resta(q),z=y.norm();y=y.mult(1/z),n.exists=1,n.P=x,n.N=y,n.t=m,n.sp=p;var A=p.color_dif,B=p.color_spec,C=p.coef_spec,D=p.coef_ref,E=new c;E.color_dif=A,E.color_spec=B,E.coef_spec=C,E.coef_ref=D,E.coef_refr=p.coef_refr,n.M=E}}}return n},h.prototype.execute=function(a,c){var d,e,f=0,h=this.cam,i=this.view,j=this.up,k=this.d,l=this.vw,m=this.vh,n=this.cw,o=this.ch,p=this.ambient,q=this.pointLights,r=this.directionalLights,s=this.spheres,t=this.antialiasing,u=(new g).makeIdentity();if(0===j.dot(j,i)){var v=j.norm();j.x=j.x/v,j.y=j.y/v,j.z=j.z/v,v=i.norm(),i.x=i.x/v,i.y=i.y/v,i.z=i.z/v;var w=j.cross(j,i);v=w.norm(),w.x=w.x/v,w.y=w.y/v,w.z=w.z/v,w.w=0,u.matrix[0][2]=i.x,u.matrix[1][2]=i.y,u.matrix[2][2]=i.z,u.matrix[3][2]=i.w,u.matrix[0][1]=j.x,u.matrix[1][1]=j.y,u.matrix[2][1]=j.z,u.matrix[3][1]=j.w,u.matrix[0][0]=w.x,u.matrix[1][0]=w.y,u.matrix[2][0]=w.z,u.matrix[3][0]=w.w}d=a*l/n,e=c*m/o,f=k;var x,y=h.copy();if(t){var z=(a+.5)*l/n,A=(c+.5)*l/n,B=new b(d,e,f),C=u.multVec(B),D=new b(z,e,f),E=u.multVec(D),F=new b(d,A,f),G=u.multVec(F),H=new b(z,A,f),I=u.multVec(H),J=this.trazar_rayo(0,C,1,Number.MAX_SAFE_INTEGER,3,p,q,r,s,1,null),K=this.trazar_rayo(0,E,1,Number.MAX_SAFE_INTEGER,3,p,q,r,s,1,null),L=this.trazar_rayo(0,G,1,Number.MAX_SAFE_INTEGER,3,p,q,r,s,1,null),M=this.trazar_rayo(0,I,1,Number.MAX_SAFE_INTEGER,3,p,q,r,s,1,null);return J=J.mult(.25),K=K.mult(.25),L=L.mult(.25),M=M.mult(.25),x=J.suma(K).suma(L).suma(M)}var N=new b(d,e,f),O=u.multVec(N);return x=this.trazar_rayo(y,O,1,Number.MAX_SAFE_INTEGER,3,p,q,r,s,1,null)},h.prototype.trazar_rayo=function(a,c,d,f,g,h,i,j,k){var l=this.intersectar(a,c,d,f,k),m=new e,n=1;if(l.exists){m=l.M.color_dif.mult(h);var o,p,q=0,r=0,s=0;for(p=0;p<i.length;p++){var t=i[p];o=new b(t.vec.x-l.P.x,t.vec.y-l.P.y,t.vec.z-l.P.z),s=this.intersectar(l.P,o,1e-4,1,k),s.exists||this.Lambert(l,o,c,q,r,t.intensity)}for(p=0;p<j.length;p++){var u=j[p];o=new b(-u.vec.x,-u.vec.y,-u.vec.z),s=this.intersectar(l.P,o,1e-4,1/0,k),s.exists||this.Lambert(l,o,c,q,r,u.intensity)}if(n&&g>0&&l.M.coef_ref>0){m=l.M.color_dif.mult(q).sum(l.M.color_spec.mult(r),m);{var v=new b,w=v.resta(c);l.N.mult(2*l.N.dot(w)).sum(c)}}}return m},a});
//# sourceMappingURL=jsraytracer.min.js.map